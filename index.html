<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Tempath - One template, several number input, returns various shape result that consists of plain svg path data!</title>
    <link rel="stylesheet" type="text/css" href="lib/codemirror/codemirror.css">
    <link rel="stylesheet" type="text/css" href="lib/codemirror/solarized.css">
    <script src="lib/jquery/jquery-2.1.1.js" type="text/javascript"></script>
    <script src="lib/paper/paper-full.js" type="text/javascript"></script>
    <script src="lib/codemirror/codemirror.js" type="text/javascript"></script>
    <script src="lib/codemirror/simple.js" type="text/javascript"></script>
    <script src="tempath/bin/tempath.js" type="text/javascript"></script>
    <style type="text/css">
    body {
        width: 1000px;
        margin: auto;
        margin-bottom: 500px;
        background-color: #040b0f;
        font-family: sans-serif;
        color: #9bc9da;
    }
    a {
        color: #fff;
    }
    .ex {
        font-size: 0;
        width: 1000px;
        height: 300px;
        margin: auto;
    }
    .ex .cm-holder {
        vertical-align: top;
        display: inline-block;
        font-size: 10pt;
        width: 400px;
        height: 100%;
    }
    .ex canvas {
        vertical-align: top;
        background-color: #26434d;
        display: inline-block;
    }
    .ex .control {
        vertical-align: top;
        display: inline-block;
        font-family: monospace;
        font-size: 10pt;
        width: 200px;
        height: 100%;
        overflow-y: scroll;
        background-color: #002b36;
        color: #839496;
    }
    .ex .control label {
        margin-left: 10px;
        color: #fff;
    }
    .ex .control input {
        margin: auto;
        margin-top: 3px;
        margin-bottom: 10px;
        padding: 4px 8px;
        display: block;
        width: 170px;
    }
    .ex .control input.run {
        margin-top: 10px;
        font-weight: bold;
        background-color: rgb(38, 216, 162);
        border: none;
        border-radius: 4px;
        border-image-source: initial;
        border-image-slice: initial;
        border-image-width: initial;
        border-image-outset: initial;
        border-image-repeat: initial;
    }
    .ex .control input[type=number] {
        font-size: 10pt;
        color: #fff;
        background-color: rgb(8, 22, 37);
        border: none;
        border-radius: 4px;
        border-image-source: initial;
        border-image-slice: initial;
        border-image-width: initial;
        border-image-outset: initial;
        border-image-repeat: initial;
    }
    </style>
</head>
<body>
    <a href="https://github.com/disjukr/tempath">
      <img style="position: absolute; top: 0; right: 0; border: 0;"
           src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"
           alt="Fork me on GitHub">
    </a>
    <h1>Tempath</h1>
    <p>Tempath is a template language for path data,
        which is the superset of <a href="http://www.w3.org/TR/SVG/paths.html#PathData">SVG Path Data syntax</a>.</p>
    <p>Inspired by <a href="https://www.kickstarter.com/projects/599698621/prototypo-streamlining-font-creation">Prototypo</a>'s
        under the hood part.</p>
    <h2>Examples</h2>
    <h3>Square</h3>
    <div class="ex">
        <div class="cm-holder">
<textarea class="cm">
# click Run Code button! ---->

prop $x 100, $y 100, $size 0~200 100
set $half_size, $size / 2
M $x - $half_size, $y - $half_size
L $x + $half_size, $y - $half_size
  $x + $half_size, $y + $half_size
  $x - $half_size, $y + $half_size
Z
</textarea>
        </div>
        <canvas></canvas>
        <div class="control">
            <input class="run" type="button" value="Run Code">
            <div class="props"></div>
            <div class="error"></div>
        </div>
    </div>
    <h3>Rotate Square</h3>
    <div class="ex">
        <div class="cm-holder">
<textarea class="cm">
prop $x 100, $y 100, $size 0~200 100
prop $rotation 0~360 0

set $pi, 3.141592653589793
set $rad, $rotation / 180 * $pi
set $eighth, $pi / 4

set $a, -$eighth
set $b, +$eighth
set $c, $pi - $eighth
set $d, $pi + $eighth

set $radius, (sqrt 2) * $size / 2

M $x + (cos $rad + $a) * $radius, $y + (sin $rad + $a) * $radius
L $x + (cos $rad + $b) * $radius, $y + (sin $rad + $b) * $radius
  $x + (cos $rad + $c) * $radius, $y + (sin $rad + $c) * $radius
  $x + (cos $rad + $d) * $radius, $y + (sin $rad + $d) * $radius
Z
</textarea>
        </div>
        <canvas></canvas>
        <div class="control">
            <input class="run" type="button" value="Run Code">
            <div class="props"></div>
            <div class="error"></div>
        </div>
    </div>
    <h3>Ganggangsullae</h3>
    <div class="ex">
        <div class="cm-holder">
<textarea class="cm">
prop $x 200, $y 150, $radius 0~150 100, $count 5
prop $box_size 10~50 30, $rotation 0~360 0

set $pi, 3.141592653589793
set $rad, $rotation / 180 * $pi
set $one, $pi * 2

def square
    prop $x, $y, $size
    set $half_size, $size / 2
    M $x - $half_size, $y - $half_size
    L $x + $half_size, $y - $half_size
      $x + $half_size, $y + $half_size
      $x - $half_size, $y + $half_size
    Z
end def

for $i in 0 ~ $count - 1
    set $r, ($one / $count) * $i
    square (cos $r + $rad) * $radius + $x
           (sin $r + $rad) * $radius + $y
           $box_size
end for
</textarea>
        </div>
        <canvas></canvas>
        <div class="control">
            <input class="run" type="button" value="Run Code">
            <div class="props"></div>
            <div class="error"></div>
        </div>
    </div>
    <h3>If</h3>
    <div class="ex">
        <div class="cm-holder">
<textarea class="cm">
# try dragging condition slider!

prop $condition 0~1, $x 0~400 200, $y 0~300 150, $size 50 ~ 100

def square
    prop $x, $y, $size
    set $half_size, $size / 2
    M $x - $half_size, $y - $half_size
    L $x + $half_size, $y - $half_size
      $x + $half_size, $y + $half_size
      $x - $half_size, $y + $half_size
    Z
end def

def circle
    prop $x, $y, $diameter
    set $radius, $diameter / 2
    M $x $y - $radius
    A 1 1 0 0 0 $x $y + $radius
    A 1 1 0 0 0 $x $y - $radius
end def

if $condition &lt; 0.5
    square $x, $y, $size
else
    circle $x, $y, $size
end if
</textarea>
        </div>
        <canvas></canvas>
        <div class="control">
            <input class="run" type="button" value="Run Code">
            <div class="props"></div>
            <div class="error"></div>
        </div>
    </div>
    <script type="text/javascript">
    // <![CDATA[
    CodeMirror.defineSimpleMode('tempath', {
        start: [
            {
                regex: /#.*(?=\r?\n|$)/,
                token: 'comment'
            },
            {
                regex: /\b(?:as|def|else|end|for|if|import|in|not|prop|set|default)\b/,
                token: 'keyword'
            },
            {
                regex: /\b(?:and|or)\b/,
                token: 'operator'
            },
            {
                regex: /[_A-Za-z]+/,
                token: 'variable'
            },
            {
                regex: /\$[_A-Za-z][_0-9A-Za-z]*/,
                token: 'variable-2'
            },
            {
                regex: /[\-+]?\d+(?:\.\d+)?/,
                token: 'number'
            },
            {
                regex: /"([^\\"]|\\.)*"/,
                token: 'string'
            },
            {
                regex: /'([^\\']|\\.)*'/,
                token: 'string'
            },
            {
                regex: /[,~\(\)\+\-\*\/<=>%]+/,
                token: 'operator'
            }
        ],
        meta: {
            lineComment: '#'
        }
    });
    function run(ex) {
        var $props = $('.control .props', ex);
        var $error = $('.control .error', ex);
        $('.cm-holder', ex)[0].cm.save();
        var canvas = $('canvas', ex)[0];
        var code = $('.cm', ex).val();
        $props.html('');
        $error.text('');
        try {
            var ast = tempath.parse(code);
        } catch (e) {
            $('.control .error', ex).text(e.message);
        }
        var propDefinitions = tempath.getPropDefinitionsByAST(ast);
        propDefinitions.forEach(function (propDefinition) {
            var name = propDefinition.name;
            var range = propDefinition.range;
            var defaultValue = propDefinition.defaultValue || 0;
            var input;
            if (range) {
                var min = Math.min(range.start, range.end);
                var max = Math.max(range.start, range.end);
                input = [
                    '<input type="range"',
                    ' value="' + defaultValue + '"',
                    ' min="' + min + '"',
                    ' max="' + max + '"',
                    ' step="0.00001"',
                    '>'
                ].join('');
            } else {
                input = [
                    '<input type="number"',
                    ' value="' + defaultValue + '"',
                    '>'
                ].join('');
            }
            $props.append($('<label>' + name + input + '</label>'));
        });
        function render() {
            $error.text('');
            var args = $props.find('input').toArray().map(function (input) { return +$(input).val(); });
            try {
                var result = tempath.renderByAST(ast, args);
            } catch (e) {
                $('.control .error', ex).text(e.message);
            }
            paper.setup(canvas);
            var path = new paper.CompoundPath(result);
            path.strokeColor = '#182b30';
            path.strokeWidth = 4;
            path.fillColor = '#2d2da0';
            paper.view.draw();
        }
        $props.find('input').on('change input', render);
        render();
    }
    function setExample(ex) {
        var cm = CodeMirror.fromTextArea($('.cm', ex)[0], {
            lineNumbers: true,
            styleActiveLine: true,
            matchBrackets: true,
            theme: 'solarized dark'
        });
        cm.setSize('100%', '100%');
        $('.cm-holder', ex)[0].cm = cm;
        var canvas = $('canvas', ex)[0];
        canvas.width = 400;
        canvas.height = 300;
        $('.run', ex).click(function () {
            run(ex);
        });
        run(ex);
    }
    $(function () {
        $('.ex').each(function () {
            setExample(this);
        });
    });
    // ]]>
    </script>
</body>
</html>
